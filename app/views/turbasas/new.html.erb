<head>
  <h1>New turbasa</h1>

  <script src="https://code.jquery.com/jquery-3.7.0.js"
  integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
  crossorigin="anonymous"></script>

  <script>
      $(document).ready(function() {
  // Загружаем список стран при загрузке страницы
      loadCountries();

  // Обработчик изменения выбранной страны
      $('#country-field').on('change', function(){
        var countrySelect = $(this).val();
        console.log(countrySelect);
        if (countrySelect) {
          loadRegions(countrySelect);
        }
        else {
          $('#region-field').empty();
        }
      });

  // Обработчик изменения выбранного региона
      $('#region-field').on('change', function(){
        var regionSelect = $(this).val();
        console.log(regionSelect);
        if (regionSelect) {
          loadTowns(regionSelect);
        }
        else {
          $('#town-field').empty();
        }
      });
      $('#town-field').on('change', function(){
        var townSelect = $(this).val();
        console.log(townSelect);
      
        });
      });

// Загрузка списка стран
      function loadCountries() {
        $.ajax({
          url: '/countries', // Путь к экшену, отвечающему за загрузку списка стран
          dataType: 'json',
          success: function(data) {
            $('#country-field').empty();
            $('#country-field').append('<option value="">Выберите страну</option>');
            $.each(data, function(index, country) {
              $('#country-field').append('<option value="' + country.id + '">' + country.name + '</option>');
            });
          }
        });
      }

// Загрузка списка регионов
      function loadRegions(country_id) {
        $.ajax({
          url: '/regions', // Путь к экшену, отвечающему за загрузку списка регионов
          dataType: 'json',
          data: { country_id: country_id },
          success: function(data) {
      // Добавление регионов в выпадающий список
            $('#region-field').empty();
            $('#region-field').append('<option value="">Выберите регион</option>');
            $.each(data, function(index, region) {
            $('#region-field').append('<option value="' + region.id + '">' + region.name + '</option>');
            });
          }
        });
    }

// Загрузка списка городов
      function loadTowns(region_id) {
        $.ajax({
          url: '/towns', // Путь к экшену, отвечающему за загрузку списка городов
          dataType: 'json',
          data: { region_id: region_id },
          success: function(data) {
      // Добавление городов в выпадающий список
            $('#town-field').empty();
            $('#town-field').append('<option value="">Выберите город</option>');
            $.each(data, function(index, town) {
              $('#town-field').append('<option value="' + town.id + '">' + town.name + '</option>');
            });
          }
        });
      }

      $('#form').submit(function(e) {
        e.preventDefault();
        var countrySelect = $('#country-field').val();
        var regionSelect = $('#region-field').val();
        var townSelect = $('#town-field').val();

    // Выполнить нужные действия с полученными данными, например, отправить на сервер
        console.log('Страна:', countrySelect);
        console.log('Регион:', regionSelect);
        console.log('Город:', townSelect);

        $.ajax({
        url: '/turbasa/create', // Путь к действию Rails для сохранения
        type: 'POST',
        dataType: 'json',
        data: { country: countrySelect, region: regionSelect, town: townSelect },
        success: function(response) {
          alert('Значения сохранены!');
        }
      });
    });

    

    // Отправьте выбранные значения на сервер для сохранения в базу данных
    
  </script>
</head>



<%= render "form", turbasa: @turbasa %>

<br>

<div>
  <%= link_to "Back to turbasas", turbasas_path %>
</div>
